---
layout: post
title: Jekyllをはじめだけ丁寧に
date: 2014-03-18
tags: jekyll ruby github
---


{% raw %}
# どんな人向け？

Ameba や Yahoo ブログなど、世の中にはいろんなブログサービスがあります。

["ブログ"検索結果](https://www.google.co.jp/search?client=safari&rls=en&q=%E3%83%96%E3%83%AD%E3%82%B0&ie=UTF-8&oe=UTF-8&gfe_rd=cr&ei=XrMnU5vSCq_J8geSp4CgCw#q=%E3%83%96%E3%83%AD%E3%82%B0&rls=en)

ぼくが好んで使っていたのが [Tumblr](http://tumblr.com/) です。デザインが秀逸なのが気に入っていました。 また、[Blogger](http://blogger.com/) も使っていました。技術よりの記事を書くのに良いかなと思ったんです。

## ローカルで作業がしたい

Web上でブログが書けるのは場所や端末を選ばないので素晴らしいのですが、よく文章を書くようになると、やはり自分の手に馴染むエディタで文書を書きたくなります。ぼくはVimが大好きなのでなんとかVimから編集してアップロードしたいと思うようになりました。

アップロードするAPIを叩いたりいろいろ試してみたのですが、あんまり楽しくありません。過去に書いた文章検索とかするのもWebに本体があると面倒です。ぼくはローカルにあるぼくのブログをWeb上に同期して表示したいのです。

## Octpress との出会い

ローカルに本体があって、Webと **簡単に** 同期してくれるような素敵なサービスはないかなーと探し始めると [Github](http://github.com/) で [OCTPRESS](http://octopress.org) と出会いました。Gihub 上に公開することでブログができるサービスです。Gitを使えばローカルとWeb上で簡単に同期できるし、ぼくにはこれこそ理想のサービスのように感じられました。

ぼくは意気揚々とOctpress環境を構築しました。そしてぼくは思いました。

**「なんだこのばかでかいシステムは」**

ぼくはただブログが書きたいのです。

Octpress のコンセプトはすごく気に入っていたのですが、ぼくはもっとミニマムにこぢんまりやりたかったのです。なんとかOctpressをもっと小さくできなかなーと調べていると Octpress は Jekyll というエンジンを利用していることを知りました。
Github が対応しているのは Jekyll エンジンであり、Jekyll さえ使っていれば Github にブログ開設できるのです。

こうしてぼくは Jekyll 氏と出会いました。

# Jekyllをはじめだけ丁寧に
Jekyll は作業ディレクトリにあるHTMLやMarkdownファイルをいい感じに Web サイトに展開してくれます。ブログ以外にも、ページの多いサイトを構築するのにも便利です。

## はじめてみる
gem を使って jekyll をインストール（けっこういろんなGem入ります）し、`new` コマンドを叩くと作業ディレクトリが作られます。
作業ディレクトリに移動し `serve` コマンドを叩けば http://localhost:4000/ にwebサーバーを立ち上げてくれます。

```
~ $ gem install jekyll
~ $ jekyll new myblog
~ $ cd myblog
~/myblog $ jekyll serve
# => Now browse to http://localhost:4000
# http://jekyllrb.com/docs/quickstart/
```

### 作成されるファイル

```
~/myblog $ ls
_config.yml _layouts/    _posts/      _site/       css/         index.html
```

`new` コマンドによって myblog ディレクトリ以下には 3 つのディレクトリと \_config.yml と index.html が作成されます。順番に見て行きます。

#### \_config.yml

`serve` コマンドを叩いた時に参照される設定が書いてあります。初期はWebサイトの名前と markdown のエンジン、pygments というコードハイライトを使うかどうかが書いてあります。他にも pagination の設定や author の設定をしたりします。[here](http://jekyllrb.com/docs/configuration/)


```
$ cat _config.yml
name: Your New Jekyll Site
markdown: redcarpet
pygments: true
```

### \_leyouts/

Jekyll では複数の HTML ファイルで共通の部分を layout に抜き出すことができます。
標準では default.html と post.html という２つのHTMLファイルが作成されています。

```
~/myblo $ ls _layouts/
default.html post.html
```

#### default.html

```
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>  {{ page.title }}</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">{{ site.name }}</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          {{ content }}

          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
```

ほぼ普通のHTMLファイルです。ちょっと違うのは `{{ page.title }}` と `{{ site.name }}` と `{{ content }}` です。`serve` コマンドはHTMLの中に `{{` と `}}` を見つけるとそこをスクリプトと解釈して展開します。erbなどと同じですね。ちなみに Jekyll が使っているテンプレートエンジンは [Liquid](http://liquidmarkup.org) です。

##### site.title

site はざっくり言うと \_config.yml 設定ファイルの内容に アクセスするためのものです。もっと詳しく知りたい人は 
[こちら](http://jekyllrb.com/docs/variables/)

##### page.title と content

HTMLやMarkdownファイルの先頭に YAML front-matter があった場合、Jekyll はファイルが展開されるべきファイルであると判断します。
index.html ファイルを見てみます。

```
---
layout: default
title: Your New Jekyll Site
---

<div id="home">
  <h1>Blog Posts</h1>
  <ul class="posts">
    {% for post in site.posts %}
      <li><span>{{ post.date | date_to_string }}</span> &raquo; <a href="{{ post.url }}">{{ post.title }}</a></li>
    {% endfor %}
  </ul>
</div>
```

まずは先頭の `---` で囲まれているところです。これが YAML front-matter であり、YAML形式でパラメータを記述したものになります。Jekyllはこの部分をファイルのパラメーターと認識します。つまり、`{{ page.title }}` ではこの `title:` の部分が展開されることになります。 `layout: default` は \_layouts/ 以下のレイアウトファイルを指定するものです。

そして `{{ content }}` には YAML front-matter を除いた部分が展開されます。

> Liquid テンプレートエンジン 
>
> `{{`と`}}`で囲まれたところは Liquid テンプレートエンジンで展開されるものだと説明しました。Liquidには他にも２つの機能があります。`{\%` と `\%}` で囲まれた部分を制御スクリプトと解釈する機能と `{`と`}`で囲まれた部分に置いて `|` 記号を使ってフィルタリングする機能です。
> Jekyllにはデフォルトで使える便利なフィルターがたくさんあります [here](http://jekyllrb.com/docs/templates/)

### \_posts/ と \_drafts
特にブログを管理するために `_posts/` と `_drafts/` の２つのディレクトリがあります（`_drafts/` 自分で作成する必要があります）。

とくに `_posts/` に含まれるファイルは `{{ site.posts }}` のようにアクセスすることができます。 `_drafts/` にあるファイルは通常は無視されますが、`jekyll serve -D` のように起動すると確認できます。

一度非公開にしたい内容や書きかけの内容は `_drafts/` ディレクトリに入れると良いと思います。ただ、Githubのpublicリポジトリを使っている場合は結局見れちゃうのであんまり意味ないですけどね :)

### \_site/

`_site/` ディレクトリはデフォルトで作成されるディレクトリではありません。`serve` コマンドを叩いた時に作成されます。`serve` で立ち上がったサーバーはこの `_site/` ディレクトリの中身を参照します。

とくに必要なディレクトリではないので `.gitignore` に追加しましょう。いらなくなったら消しても構いません。

## 他には？

あまり強力ではありませんが pagination が用意されています。ちょっと面倒だなーと思う人は [Jekyll bootstrap](http://jekyllbootstrap.com) を使うと良いかもしれません。新しいページやポストを作成する便利な Rakefile がついてます。

## まとめ

* `jekyll new` コマンドでサイト作成
* `jekyll serve` コマンドでサーバー立ち上げ 
* 実態は `_site/` ディレクトリ
* `_layouts/` ディレクトリにレイアウトを置いて DRY に
* YAML front-formatter があると展開される (ないと単純なコピー）
* Liquid テンプレートエンジンを使っている
{% endraw %}
