アプリに入れるデータは MacRuby で作っていたりします。Objective-C でも良いんだけど、コンパイルとか面倒だし、テキスト処理は Ruby だと楽チンだし♪ <pre class="brush: ruby"><br />#! /usr/local/bin/macruby<br /># coding:utf-8<br />#<br /><br />framework 'Foundation'<br />framework 'CoreData'<br /><br />DB_NAME = "Question"<br />ENTITY_NAME = "Question"<br /><br />class DB<br />  def managedObjectModel<br />    if (@managedObjectModel != nil)<br />        return @managedObjectModel<br />    end<br />    modelURL = NSURL.URLWithString Dir.pwd+"/#{DB_NAME}.momd"<br />    @managedObjectModel = NSManagedObjectModel.alloc.initWithContentsOfURL(modelURL)   <br />    return @managedObjectModel<br />  end<br /><br />  def persistentStoreCoordinator<br />    if (@persistentStoreCoordinator != nil)<br />        return @persistentStoreCoordinator<br />    end<br />    <br />    storeURL = NSURL.fileURLWithPath Dir.pwd+"/#{DB_NAME}.sqlite"<br />   <br />    error = Pointer.new(:object)<br />    @persistentStoreCoordinator = NSPersistentStoreCoordinator.alloc.initWithManagedObjectModel(self.managedObjectModel)<br />    if (!@persistentStoreCoordinator.addPersistentStoreWithType(NSSQLiteStoreType, configuration:nil, URL:storeURL, options:nil, error:error))<br />        puts "Unresolved error #{error}, #{error.userInfo}"<br />        abort()<br />    end<br />    <br />    return @persistentStoreCoordinator<br />    <br />  end<br /><br />  def managedObjectContext<br />    if (@managedObjectContext != nil)<br />        return @managedObjectContext<br />    end<br />    <br />    coordinator = self.persistentStoreCoordinator<br />    if (coordinator != nil)<br />        @managedObjectContext = NSManagedObjectContext.alloc.init<br />        @managedObjectContext.setPersistentStoreCoordinator(coordinator)<br />    end<br />    return @managedObjectContext<br />  end<br /><br /><br /><br />  def saveContext<br />    error = Pointer.new(:object)<br />    managedObjectContext = self.managedObjectContext<br />    if (managedObjectContext != nil)<br />        if (managedObjectContext.hasChanges || !managedObjectContext.save(error))<br />            puts "Unresolved error #{error}, #{error.userInfo}"<br />            abort()<br />        end<br />    end<br />  end<br />    <br />end<br /><br />`/Developer/usr/bin/momc #{DB_NAME}.xcdatamodeld #{DB_NAME}.momd`<br />if File.exist? "#{DB_NAME}.sqlite"<br />  File.delete "#{DB_NAME}.sqlite"<br />end<br /><br />db = DB.new<br />p model = db.managedObjectModel<br /><br />var = {"YEAR" => 2010}<br />request = model.fetchRequestFromTemplateWithName("QuestionsWithYear", substitutionVariables:var)<br /><br />p request.predicate.predicateFormat<br /><br />db.saveContext<br /></pre>
