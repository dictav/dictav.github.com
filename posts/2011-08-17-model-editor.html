Xcode には CoreData で操作するモデル作成する GUI エディタがある。こんなやつ。 <div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Yv2ev1KwtAg/TktnR5tU8JI/AAAAAAAAAHU/9DxyDwPznBs/s1600/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588%25EF%25BC%25882011-08-17%2B15.59.32%25EF%25BC%2589.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="150" width="320" src="http://1.bp.blogspot.com/-Yv2ev1KwtAg/TktnR5tU8JI/AAAAAAAAAHU/9DxyDwPznBs/s320/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588%25EF%25BC%25882011-08-17%2B15.59.32%25EF%25BC%2589.png" /></a></div> 画像の左に "Fetch Requests" という項目があるが、これは名前が示す通り NSFetchRequest を定義しておけるものだ。ソースコードに書くといろいろややこしく、見づらくなってしまうけど、モデルデータに格納しておけば比較的すっきりと書くことができる。  <pre class="brush: objc"><br />NSURL *modelURL = [NSURL URLWithString:path];<br />NSManagedObjectModel *managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];<br />// モデルデータにある Fetch Request の一覧を取得<br />NSDictionary *requests = [managedObjectModel fetchRequestTemplatesByName];<br />// 名前を元に特定の Fetch Request を取得<br />NSFetchRequest *request = [managedObjectModel fetchRequestTemplateForName:@"MyFetchRequest"];<br /></pre> さて、この Fetch Request であるが、"year == 2011" などの定数を元に作成してもあまり恩恵はない。やはり変数を扱える方が嬉しい。Xcode3 までは Editor のポップアップに VARIABLE という項目があり、簡単に利用する事ができた。Xcode4 からはこの選択項目がなくなり、自分で記入しなければいけないので注意が必要。NSPredicate を使った事がある人なら分かると思うが、変数を扱うには $ 記号を使って変数名を指定してあげれば良い。この時、expression を選択しておくのがポイントだ。  <div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Ngr8j8pmESY/TktqcTMSXWI/AAAAAAAAAHc/lNAxKlyd52w/s1600/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588%25EF%25BC%25882011-08-17%2B15.59.59%25EF%25BC%2589.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="56" width="320" src="http://1.bp.blogspot.com/-Ngr8j8pmESY/TktqcTMSXWI/AAAAAAAAAHc/lNAxKlyd52w/s320/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588%25EF%25BC%25882011-08-17%2B15.59.59%25EF%25BC%2589.png" /></a></div> このようにして作成した Fetch Request のテンプレートは fetchRequestTemplateForName: ではなく fetchRequestFromTemplateWithName:substitutionVariables: を使って呼び出す。   <pre class="brush: objc"><br />NSDictionary *variables = [NSDictionary dictionaryWithObject:[NSNumber numberWithInteger:2010] forKey:@"YEAR"];<br />NSFetchRequest *request = [managedObjectModel fetchRequestFromTemplateWithName:@"QuestionsWithYear" substitutionVariables:variables];<br /></pre>
